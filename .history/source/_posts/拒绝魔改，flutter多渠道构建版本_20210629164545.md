---
title: 拒绝魔改，flutter多渠道构建版本
date: 2021-05-24 14:15:48
tags:
- flutter
- 原生
- android
- ios
- 多渠道
categories:
- Technology
- Flutter
photos: 
- https://raw.githubusercontent.com/lovexinforever/blog_back_up/master/photos/2018-4-28_好看的树.jpg
top: 10
essential: true
---

用flutter开发项目一段时间后，发现切换环境实在太麻烦，每次都手动修改环境，随着参数的越来越多， 很容易就忘记修改哪个参数，导致环境切换出问题，所以就想到了android以前做是可以做多渠道的，所以也想试试flutter的多渠道。

## 准备工作

### flutter命令
在 Flutter 1.17 中，Flutter 会将在编译前将 dart-defines 传递给 iOS、Android、macOS。
因此，可以几乎在各个时刻调用预先定义的 dart-defines。

```
--dart-define=DART_DEFINE_APP_ENV=debug
```

## flutter端处理
- 声明环境变量
```
// 声明的环境
abstract class EnvName {
  // 环境key
  static const String envKey = "DART_DEFINE_APP_ENV";

  // 环境value
  static const String debug = "debug";
  static const String release = "release";

  static const String debugServer = "debugServer";
}
```

- 声明环境配置
```
///环境配置
class EnvConfig {
  ///服务器url
  final String? host;

  EnvConfig(
      {this.host
      });
}
```
- 环境定义
```
// 开发环境
  static final EnvConfig _debugConfig = EnvConfig(
      host: "http://129.211.191.80:10003/app",
  );
  // 后端本地服务器
  static final EnvConfig _debugServerConfig = EnvConfig(
      host: "http://192.168.1.162:10003/app",);

  // 发布环境
  static final EnvConfig _releaseConfig = EnvConfig(
      host: "https://api.dzds.dianzedushu.com/app");
```
- 获取当前环境
```
// 获取到当前环境
  static const appEnv = String.fromEnvironment(EnvName.envKey);
```
就是通过 `String.fromEnvironment` 来获取当前环境,然后根据环境去取不同的值

- 根据环境获取相关配置
```
static EnvConfig _getEnvConfig() {
    switch (appEnv) {
      case EnvName.debug:
        return _debugConfig;
      case EnvName.debugServer:
        return _debugServerConfig;
      case EnvName.release:
        return _releaseConfig;

      default:
        return _releaseConfig;
    }
  }
```
## 调用





